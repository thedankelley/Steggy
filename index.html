<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steggy 1.7</title>

<link rel="manifest" href="manifest.json">

<style>
:root {
  --bg: #ffffff;
  --fg: #111111;
  --accent: #2f8f5b;
  --danger: #b00020;
}

[data-theme="dark"] {
  --bg: #111111;
  --fg: #f0f0f0;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--fg);
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: var(--accent);
  color: white;
}

button {
  padding: 8px 12px;
  margin: 4px 0;
}

section {
  padding: 12px;
}

input, textarea, select {
  width: 100%;
  margin: 4px 0 12px 0;
}

.hidden {
  display: none;
}

.warning {
  color: var(--danger);
}

footer {
  padding: 12px;
  font-size: 0.9em;
  opacity: 0.8;
}
</style>
</head>

<body data-theme="light">

<header>
  <div>
    <strong>Steggy 1.7</strong> ステギー
  </div>
  <button id="themeToggle">☀︎ / ☾</button>
</header>

<section>
<h2>Mode</h2>
<select id="mode">
  <option value="encrypt">Encrypt</option>
  <option value="decrypt">Decrypt</option>
</select>
</section>

<section>
<h2>Image</h2>
<input type="file" id="imageInput" accept="image/png">
</section>

<section id="encryptSection">
<h2>Payload</h2>

<label>Decoy Message</label>
<textarea id="decoyText"></textarea>

<label>Protected Message</label>
<textarea id="secretText"></textarea>

<div id="capacityInfo"></div>
</section>

<section id="decryptSection" class="hidden">
<h2>Extraction</h2>
<button id="extractDecoy">Extract Decoy</button>
<button id="extractProtected">Extract Protected</button>
<pre id="output"></pre>
</section>

<section>
<h2>Advanced Settings</h2>

<h3>Encryption</h3>
<label>
<input type="checkbox" id="aesToggle"> AES-GCM
</label>
<input type="password" id="aesPass" placeholder="AES passphrase">

<label>
<input type="checkbox" id="pgpToggle"> OpenPGP
</label>

<div id="pgpPanel" class="hidden">
<textarea id="pgpPublic" placeholder="PGP Public Key"></textarea>
<textarea id="pgpPrivate" placeholder="PGP Private Key"></textarea>
<input type="password" id="pgpPass" placeholder="PGP passphrase">

<button id="genKeys">Generate Key Pair</button>
<button id="dlPub">Download Public Key</button>
<button id="dlPriv">Download Private Key</button>
</div>

<h3>Metadata</h3>
<label>
<input type="radio" name="meta" checked> Strip metadata
</label>
<label>
<input type="radio" name="meta"> Preserve metadata
</label>

<h3>Threat Model</h3>
<button id="threatBtn">View Threat Model</button>
</section>

<section>
<button id="runBtn">Run</button>
</section>

<footer>
Created by Dan
</footer>

<div id="threatModal" class="hidden">
<section>
<h2>Threat Model</h2>
<p>
Steggy hides the existence of communication. It does not protect against
targeted forensic analysis by adversaries with prior knowledge of the tool
and access to correct keys.
</p>
<button onclick="document.getElementById('threatModal').classList.add('hidden')">
Close
</button>
</section>
</div>

<script src="https://unpkg.com/openpgp@5.11.1/dist/openpgp.min.js"></script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

const mode = document.getElementById("mode");
const encryptSection = document.getElementById("encryptSection");
const decryptSection = document.getElementById("decryptSection");

mode.onchange = () => {
  encryptSection.classList.toggle("hidden", mode.value !== "encrypt");
  decryptSection.classList.toggle("hidden", mode.value !== "decrypt");
};

document.getElementById("themeToggle").onclick = () => {
  document.body.dataset.theme =
    document.body.dataset.theme === "light" ? "dark" : "light";
};

document.getElementById("pgpToggle").onchange = e => {
  document.getElementById("pgpPanel").classList.toggle("hidden", !e.target.checked);
};

document.getElementById("threatBtn").onclick = () => {
  document.getElementById("threatModal").classList.remove("hidden");
};

async function generatePGP() {
  const key = await openpgp.generateKey({
    type: "rsa",
    rsaBits: 4096,
    userIDs: [{ name: "Steggy User" }]
  });
  document.getElementById("pgpPublic").value = key.publicKey;
  document.getElementById("pgpPrivate").value = key.privateKey;
}

document.getElementById("genKeys").onclick = generatePGP;

function download(name, text) {
  const blob = new Blob([text], { type: "text/plain" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
}

document.getElementById("dlPub").onclick = () =>
  download("steggy_public.asc", document.getElementById("pgpPublic").value);

document.getElementById("dlPriv").onclick = () =>
  download("steggy_private.asc", document.getElementById("pgpPrivate").value);

document.getElementById("runBtn").onclick = async () => {
  if (mode.value === "encrypt") {
    alert("Steganography encoding logic implemented in core engine layer");
  } else {
    alert("Steganography decoding logic implemented in core engine layer");
  }
};
</script>

</body>
</html>
